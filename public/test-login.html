<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Login / Register</title>
      <link rel="stylesheet" href="css/register.css" />
    </head>
    <body>
        <div class="container">
            <div class="section">
                <h2>Inscription</h2>
                <input type="text" id="regId" placeholder="Identifiant">
                <input type="password" id="regPassword" placeholder="Mot de passe">
                <input type="text" id="regPseudo" placeholder="Pseudo">
                <input type="color" id="regColor" value="#2d7dff">
                <button id="btnRegister">S'inscrire</button>
                <div id="regResult" class="result"></div>
            </div>
            
            <div class="section">

                <h2>Connexion</h2>
                <input type="text" id="identifiant" placeholder="Identifiant">
                <input type="password" id="loginPassword" placeholder="Mot de passe">
                <button id="btnLogin">Se connecter</button>
                <div id="loginResult" class="result"></div>
            </div>

            
            <div class="section">
                <h2>Profil</h2>
                <button id="btnMe">Voir mon profil</button>
                <div id="meResult" class="result"></div>
            </div>


            <div class="section">
                <h2>Déconnexion</h2>
                <button id="btnLogout">Se déconnecter</button>
                <div id="logoutResult" class="result"></div>
            </div>

            <div class="section">
                <h2>Revenir à la partie</h2>
                <button id="backBtn">Revenir à la partie !</button>
            </div>
        </div>
        <script>
            // Fonction pour que les boites de résultats soient invisible au début, et apparaissent que lorsque l'on a un resultat
            function showResult(elementId, message, isSuccess = true) {
                document.querySelectorAll('.result').forEach(elem => {
                    elem.classList.remove('visible', 'error');
                    elem.textContent = '';
                });

                // Affiche le résultat demandé
                const element = document.getElementById(elementId);
                element.textContent = message;
                if (isSuccess){
                    element.className = 'result visible';
                } else {
                    element.className = 'result error visible';
                }
            }


            const api = (url, data) =>
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data), //Choppe les info en string !
            }).then(r => r.json());

            const backBtn = document.getElementById("backBtn");
            //BOuton retour au lobby
            backBtn.onclick = async () => {
                window.location.href = "/partie.html";
            };

            //Comportement bouton register
            document.getElementById('btnRegister').onclick = async () => {
                const identifiant = document.getElementById('regId').value.trim();
                const password = document.getElementById('regPassword').value.trim();
                const pseudo = document.getElementById('regPseudo').value.trim();
                const color = document.getElementById('regColor').value;

                if (!identifiant || !password || !pseudo){ //double vérification entre le client et le serveur, ca sert peut etre a rien mais je prefere
                    showResult('regResult', 'Tous les champs sont obligatoires !', false);
                    return;
                }

                const res = await api('/auth/register', { identifiant, password, pseudo, color });
                showResult('regResult', res.message, res.ok);
            };

            //Comportement bouton login
            document.getElementById('btnLogin').onclick = async () => {
                //.trim enleve les espaces avant et apres
                const identifiant = document.getElementById('identifiant').value.trim();
                const password = document.getElementById('loginPassword').value.trim();

                if (!identifiant || !password){
                    showResult('loginResult', 'Tous les champs sont obligatoires !', false);
                    return;
                }

                const res = await api('/auth/login', { identifiant, password });
                showResult('loginResult', res.message, res.ok);
            };

            //Comportement bouton profil
            document.getElementById('btnMe').onclick = async () => {
                const res = await api('/me',{});
                showResult('meResult', res.message, res.ok);
            };

            //Comportement bouton déconnexion
            document.getElementById('btnLogout').onclick = async () => {
                const res = await api('/auth/logout', {
                });
                showResult('logoutResult', res.message || "Déconnecté", res.ok);
            };
        </script>
    </body>
</html>

